#need to have some stuff
gene=ATP8

#nucleotide databases
gene_database=''

#single gene protein directory
gene_prot_path=''

#list of code of mitogenomes that need to be annoted
list_code=''

#set working directory
working_directory=$PWD

#settings
line_output_value=1230

#build hmm profile of alignment, nucleotide one
mafft --auto $gene_database > $gene'.nucl.align.fasta'
hmmbuild $gene'.nucl.hmm' $gene'.nucl.align.fasta' 

#retrieve every fasta genome from ncbi
#downloading every species from the list
for species in $(cat $list_code)
    do mkdir $species
    esearch -db nuccore -query $species | efetch -format fasta > $species/$species'.fasta'
    esearch -db nuccore -query $species | efetch -format gff3 > $species/$species'.gff3'
    done

#hmmscan every fasta genome whose missing the gene
echo 'hmmscanning every downloaded genome, looking fot whats missing'
for species in $(cat $list_code)
    do hmmsearch -o $species/$species'.out' $gene'.hmm' $species/$species'.fasta'
    /home/PERSONALE/diego.carli2/app/gene_missing_annotation/split.hmm.files.py --input_files $species/$species'.out'
    cd $species/$species'.output_files'
    for outfile in $(python /home/PERSONALE/diego.carli2/app/gene_missing_annotation/find_files_unusual_size.py $PWD | awk -F ":" '{print $1}')
        do python /home/PERSONALE/diego.carli2/app/gene_missing_annotation/read.hmm.output.py $species $outfile
        done
    python /home/PERSONALE/diego.carli2/app/my_alias/extract_nc_regions.py $species'.fasta' $species'.gff3' $species'.nc.fasta'
    cd $working_directory
    done
